{% extends 'base.html' %}
{% block content %}
<h2>–§–∞–Ω—Ñ–∏–∫–∏</h2>

{% for post in posts %}
    <div style="margin-bottom: 20px;">
        <!-- –ê–≤—Ç–æ—Ä -->
        <a href="{% url 'user_profile' post.author.username %}">
            <img src="{{ post.author.avatar.url }}" width="40" height="40" style="border-radius: 50%;">
            {{ post.author.username }}
        </a>

        <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
        <h3><a href="{% url 'post_detail' post.pk %}">{{ post.title }}</a></h3>

        <!-- –¢–µ–∫—Å—Ç -->
        <p>{{ post.content }}</p>

        <!-- –ö–∞—Ä—Ç–∏–Ω–∫–∞ -->
        {% if post.image %}
            <img src="{{ post.image.url }}" style="max-width: 400px;">
        {% endif %}

        <!-- –õ–∞–π–∫–∏ -->
        <form method="post" action="{% url 'like_post' %}">
            {% csrf_token %}
            <input type="hidden" name="post_id" value="{{ post.id }}">
            <button type="submit">
                {% if user in post.likes.all %}
                    ‚ù§Ô∏è
                {% else %}
                    ü§ç
                {% endif %}
                {{ post.likes.count }}
            </button>
        </form>
        <form method="post" action="{% url 'toggle_favorite' pk=post.pk %}">
            {% csrf_token %}
            {% if user in post.favorites.all %}
                <button type="submit">–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ ‚≠ê</button>
            {% else %}
                <button type="submit">–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ ‚≠ê</button>
            {% endif %}
        </form>        
        <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
        <div style="margin-top: 10px;">
            <a href="{% url 'post_detail' post.pk %}" style="text-decoration: none;">
                üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ post.comments.count }})
            </a>
        </div>

        <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->
        {% if user == post.author %}
            <div style="margin-top: 10px;">
                <a href="{% url 'edit_post' post.pk %}" style="margin-right: 10px;">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                <form action="{% url 'delete_post' post.pk %}" method="post" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç?');">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                </form>
            </div>
        {% endif %}

        <hr>
    </div>
{% endfor %}

{% if user.is_authenticated %}
    <a href="{% url 'create_post' %}">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–Ω—Ñ–∏–∫</a>
{% endif %}
{% endblock %}
